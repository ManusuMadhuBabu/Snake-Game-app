pipeline {
	agent any
	environment {
		image_name = "madhu"
		image_tag = "i"
	}
	stages{
		stage('Checkout code') {
			steps{
				git branch : 'main' ,
				url : 'https://github.com/ManusuMadhuBabu/Snake-Game-app.git'
			}
		}
		stage('build Docker image'){
			steps{
				script{
					sh """
						docker build -t ${image_name}:${image_tag} .
					"""
				}
			}
		}
		stage('login to Docker Hub'){
			steps{
				script{
					withCredentials([usernamePassword(
						credentialsId:'dockerhub',
						usernameVariable : 'DOCKER_USER',
						passwordVariable : 'DOCKER_PASS'
					)]){
						sh " echo $DOCKER_PASS | docker login -u $DOCKER_USER --password-stdin"
						}
				}
			}
		}
		stage('push image to docker hub'){
			steps{
				script{
					sh """
					docker push ${image_name}:${image_tag}
					"""
				}
			}
		}
		stage('Deploy a container)'{
			steps{
				script{
					sh """
					docker rm -f snake-app || true
					docker run -d --name snake-app -p 3000:3000 ${image_name}:${image_tag}
					"""
				}
			}
		}
	}
}

